<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자산 관리 대시보드</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>💰 자산 관리 대시보드</h1>
                <div class="header-controls">
                    <div class="date-control">
                        <label for="baseDate">기준일자:</label>
                        <input type="date" id="baseDate">
                        <span id="exchangeRate" class="exchange-rate"></span>
                    </div>
                    <div class="user-info">
                        <img id="userPhoto" src="" alt="" style="display:none;">
                        <span id="userName"></span>
                        <button onclick="location.href='asset-template.html'" class="template-btn">📋 템플릿</button>
                        <button onclick="document.getElementById('excelUpload').click()" class="upload-btn">📤 업로드</button>
                        <input type="file" id="excelUpload" accept=".xls,.xlsx,.csv" style="display:none;" onchange="handleExcelUpload(event)">
                        <button onclick="exportToExcel()" class="export-btn">📥 다운로드</button>
                        <button onclick="logout()" class="logout-btn">로그아웃</button>
                    </div>
                </div>
            </div>
            <div class="owner-tabs">
                <button class="owner-tab active" onclick="filterByOwner('all')">👥 전체</button>
                <button class="owner-tab" onclick="filterByOwner('희준')">👤 희준</button>
                <button class="owner-tab" onclick="filterByOwner('영은')">👤 영은</button>
            </div>
            <div class="total-assets">
                <h2>총 자산</h2>
                <p class="total-amount" id="totalAssets">0원</p>
                <div class="asset-change" id="assetChange"></div>
            </div>
        </header>

        <div class="dashboard">
            <!-- 자산 요약 카드 -->
            <div class="summary-cards">
                <div class="card">
                    <h3>💵 현금/예금</h3>
                    <p class="amount" id="cashTotal">0원</p>
                    <button onclick="location.href='accounts.html'">계좌 관리</button>
                </div>
                <div class="card">
                    <h3>📈 주식/ETF</h3>
                    <p class="amount" id="stockTotal">0원</p>
                    <button onclick="location.href='accounts.html'">계좌 관리</button>
                </div>
                <div class="card">
                    <h3>💎 채권/원자재</h3>
                    <p class="amount" id="cryptoTotal">0원</p>
                    <button onclick="location.href='accounts.html'">계좌 관리</button>
                </div>
                <div class="card">
                    <h3>₿ 가상화폐</h3>
                    <p class="amount" id="realEstateTotal">0원</p>
                    <button onclick="location.href='accounts.html'">계좌 관리</button>
                </div>
            </div>

            <!-- 차트 섹션 -->
            <div class="charts">
                <div class="chart-container">
                    <h3>자산 분포</h3>
                    <canvas id="assetPieChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>자산 추이</h3>
                    <canvas id="assetTrendChart"></canvas>
                </div>
            </div>

            <!-- 상세 내역 -->
            <div class="details-section">
                <h3>상세 내역</h3>
                <div class="tabs">
                    <button class="tab active" onclick="showTab('cash')">현금/예금</button>
                    <button class="tab" onclick="showTab('stock')">주식/펀드</button>
                    <button class="tab" onclick="showTab('crypto')">암호화폐</button>
                    <button class="tab" onclick="showTab('realEstate')">부동산/기타</button>
                </div>
                <div id="detailsContent"></div>
            </div>
        </div>

        <!-- 모달 -->
        <div id="assetModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 id="modalTitle">자산 추가/수정</h2>
                <form id="assetForm">
                    <input type="hidden" id="assetType">
                    <input type="hidden" id="editIndex">

                    <div class="form-row">
                        <div class="form-col">
                            <label for="assetOwner">소유자 *</label>
                            <select id="assetOwner" required>
                                <option value="희준">희준</option>
                                <option value="영은">영은</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="assetCountry">국가</label>
                            <select id="assetCountry">
                                <option value="한국">한국</option>
                                <option value="미국">미국</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="assetInstitution">금융사</label>
                            <input type="text" id="assetInstitution" placeholder="예: 신한은행, 미래에셋">
                        </div>
                        <div class="form-col">
                            <label for="assetAccountType">계좌유형</label>
                            <select id="assetAccountType">
                                <option value="">선택</option>
                                <option value="예금">예금</option>
                                <option value="적금">적금</option>
                                <option value="증권">증권</option>
                                <option value="펀드">펀드</option>
                                <option value="연금">연금</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                    </div>

                    <label for="assetName">자산명 *</label>
                    <input type="text" id="assetName" required placeholder="예: 삼성전자, S&P500 ETF">

                    <div class="form-row">
                        <div class="form-col">
                            <label for="assetCurrency">통화 *</label>
                            <select id="assetCurrency" required>
                                <option value="KRW">원화 (KRW)</option>
                                <option value="USD">달러 (USD)</option>
                            </select>
                        </div>
                        <div class="form-col">
                            <label for="assetLiquidity">유동구분</label>
                            <select id="assetLiquidity">
                                <option value="유동">유동</option>
                                <option value="비유동">비유동</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="assetTicker">티커 (주식/ETF만)</label>
                            <input type="text" id="assetTicker" placeholder="예: 005930.KS, AAPL">
                        </div>
                        <div class="form-col">
                            <label for="assetQuantity">보유량</label>
                            <input type="number" id="assetQuantity" step="0.01" placeholder="주식 수량">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="assetPurchasePrice">매입가</label>
                            <input type="number" id="assetPurchasePrice" step="0.01" placeholder="주당 매입가">
                        </div>
                        <div class="form-col">
                            <label for="assetPurchaseAmount">투자원금</label>
                            <input type="number" id="assetPurchaseAmount" step="0.01" placeholder="총 투자원금">
                        </div>
                    </div>

                    <label for="assetAmount">현재 평가금액 *</label>
                    <input type="number" id="assetAmount" required step="0.01">

                    <label for="assetNote">메모</label>
                    <input type="text" id="assetNote" placeholder="추가 설명">

                    <div class="form-buttons">
                        <button type="submit">저장</button>
                        <button type="button" onclick="closeModal()">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script src="script.js"></script>
</body>
</html>
